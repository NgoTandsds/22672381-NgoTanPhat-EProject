## 1ï¸âƒ£ Há»‡ thá»‘ng giáº£i quyáº¿t váº¥n Ä‘á» gÃ¬?

Há»‡ thá»‘ng Ä‘Æ°á»£c xÃ¢y dá»±ng Ä‘á»ƒ mÃ´ phá»ng hoáº¡t Ä‘á»™ng cá»§a má»™t website thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ cÆ¡ báº£n, trong Ä‘Ã³:

* NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘Äƒng kÃ½ â€“ Ä‘Äƒng nháº­p tÃ i khoáº£n.

* Quáº£n trá»‹ viÃªn cÃ³ thá»ƒ thÃªm sáº£n pháº©m.

* NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘áº·t hÃ ng trá»±c tiáº¿p.

Há»‡ thá»‘ng cÃ³ kháº£ nÄƒng xá»­ lÃ½ nhiá»u tÃ¡c vá»¥ song song, linh hoáº¡t má»Ÿ rá»™ng nhá» Ã¡p dá»¥ng kiáº¿n trÃºc Microservices.
â¡ï¸ Má»¥c tiÃªu chÃ­nh: MÃ´ phá»ng quy trÃ¬nh váº­n hÃ nh thá»±c táº¿ cá»§a má»™t trang TMÄT Ä‘Æ¡n giáº£n tá»« xÃ¡c thá»±c Ä‘áº¿n xá»­ lÃ½ Ä‘Æ¡n hÃ ng.

## 2ï¸âƒ£ Há»‡ thá»‘ng cÃ³ bao nhiÃªu dá»‹ch vá»¥?

Tá»•ng cá»™ng cÃ³ 4 service chÃ­nh vÃ  2 service phá»¥ trá»£:

Loáº¡i	  TÃªn Service	    Vai trÃ²
ChÃ­nh	  Auth Service	  Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
ChÃ­nh	  Product Service	Quáº£n lÃ½ sáº£n pháº©m
ChÃ­nh	  Order Service	  Xá»­ lÃ½ Ä‘Æ¡n hÃ ng
ChÃ­nh	  API Gateway	    Trung gian Ä‘iá»u phá»‘i request
Phá»¥	    MongoDB	        LÆ°u trá»¯ dá»¯ liá»‡u
Phá»¥	    RabbitMQ	      Message Broker trung gian
## 3ï¸âƒ£ Ã nghÄ©a tá»«ng dá»‹ch vá»¥

Auth Service ğŸ§
â†’ Xá»­ lÃ½ Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, sinh token JWT, xÃ¡c thá»±c quyá»n truy cáº­p.

Product Service ğŸ“¦
â†’ Quáº£n lÃ½ sáº£n pháº©m, thÃªm â€“ sá»­a â€“ xÃ³a â€“ láº¥y thÃ´ng tin sáº£n pháº©m.

Order Service ğŸ›’
â†’ Táº¡o Ä‘Æ¡n hÃ ng, xÃ¡c thá»±c token, tÆ°Æ¡ng tÃ¡c vá»›i Product Ä‘á»ƒ láº¥y thÃ´ng tin sáº£n pháº©m.

API Gateway ğŸšª
â†’ Nháº­n táº¥t cáº£ request tá»« client, Ä‘á»‹nh tuyáº¿n Ä‘áº¿n cÃ¡c service phÃ¹ há»£p, giÃºp há»‡ thá»‘ng cÃ³ má»™t Ä‘iá»ƒm truy cáº­p duy nháº¥t.

MongoDB ğŸ—ƒï¸
â†’ LÆ°u dá»¯ liá»‡u ngÆ°á»i dÃ¹ng, sáº£n pháº©m vÃ  Ä‘Æ¡n hÃ ng theo tá»«ng service riÃªng biá»‡t.

RabbitMQ ğŸ“¨
â†’ Äáº£m báº£o cÃ¡c service cÃ³ thá»ƒ giao tiáº¿p báº¥t Ä‘á»“ng bá»™ (event-driven), trÃ¡nh ngháº½n há»‡ thá»‘ng khi cÃ³ nhiá»u Ä‘Æ¡n hÃ ng.

## 4ï¸âƒ£ CÃ¡c máº«u thiáº¿t káº¿ Ä‘Æ°á»£c sá»­ dá»¥ng
Máº«u thiáº¿t káº¿	MÃ´ táº£	Ãp dá»¥ng
Microservices Pattern	TÃ¡ch há»‡ thá»‘ng thÃ nh nhiá»u service Ä‘á»™c láº­p, dá»… má»Ÿ rá»™ng & báº£o trÃ¬	Auth, Product, Order
API Gateway Pattern	Gom cÃ¡c request vÃ o 1 Ä‘iá»ƒm truy cáº­p duy nháº¥t	api-gateway
Event-driven Architecture	Sá»­ dá»¥ng message queue Ä‘á»ƒ giao tiáº¿p service báº¥t Ä‘á»“ng bá»™	RabbitMQ
Repository Pattern (má»©c logic code)	TÃ¡ch biá»‡t logic truy cáº­p dá»¯ liá»‡u vá»›i logic nghiá»‡p vá»¥	Má»—i service Node.js
## 5ï¸âƒ£ CÃ¡c dá»‹ch vá»¥ giao tiáº¿p nhÆ° tháº¿ nÃ o?
![alt text](public/1.png)
![alt text](public/compose-application.png)
![alt text](public/custom-service-api-gateway.png)
![alt text](public/compose-application.png)

Client gá»­i request Ä‘áº¿n API Gateway.

API Gateway Ä‘á»‹nh tuyáº¿n Ä‘áº¿n service tÆ°Æ¡ng á»©ng:

/register, /login â†’ Auth Service

/products â†’ Product Service

/orders â†’ Order Service

Khi táº¡o Ä‘Æ¡n hÃ ng, Order Service gá»­i message qua RabbitMQ Ä‘á»ƒ thÃ´ng bÃ¡o vÃ  xá»­ lÃ½ logic liÃªn quan mÃ  khÃ´ng lÃ m cháº­m request cá»§a ngÆ°á»i dÃ¹ng.

Má»—i service káº¿t ná»‘i Ä‘áº¿n database riÃªng trÃªn MongoDB, Ä‘áº£m báº£o tÃ­nh Ä‘á»™c láº­p vÃ  má»Ÿ rá»™ng.
# E-Project: Há»‡ thá»‘ng Microservices BÃ¡n hÃ ng

ÄÃ¢y lÃ  má»™t dá»± Ã¡n backend mÃ´ phá»ng má»™t há»‡ thá»‘ng thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ Ä‘Æ¡n giáº£n, Ä‘Æ°á»£c xÃ¢y dá»±ng theo kiáº¿n trÃºc microservices.

## Kiáº¿n trÃºc há»‡ thá»‘ng

Há»‡ thá»‘ng bao gá»“m cÃ¡c thÃ nh pháº§n chÃ­nh sau:
* **API Gateway**: Cá»•ng chÃ­nh tiáº¿p nháº­n táº¥t cáº£ request tá»« client vÃ  Ä‘iá»u hÆ°á»›ng Ä‘áº¿n cÃ¡c service phÃ¹ há»£p.
* **Auth Service**: Xá»­ lÃ½ táº¥t cáº£ cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n xÃ¡c thá»±c ngÆ°á»i dÃ¹ng (Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, JWT).
* **Product Service**: Quáº£n lÃ½ thÃ´ng tin vá» sáº£n pháº©m.
* **Order Service**: Xá»­ lÃ½ logic Ä‘áº·t hÃ ng vÃ  tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c service khÃ¡c qua message queue.
* **MongoDB**: CÆ¡ sá»Ÿ dá»¯ liá»‡u NoSQL Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u cho cÃ¡c service.
* **RabbitMQ**: Message Broker Ä‘á»ƒ giao tiáº¿p báº¥t Ä‘á»“ng bá»™ giá»¯a cÃ¡c service (vÃ­ dá»¥: khi má»™t Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c táº¡o).


---

## YÃªu cáº§u cÃ i Ä‘áº·t

Äá»ƒ cháº¡y dá»± Ã¡n nÃ y, báº¡n cáº§n cÃ i Ä‘áº·t cÃ¡c pháº§n má»m sau trÃªn mÃ¡y tÃ­nh cá»§a mÃ¬nh:
* [Docker](https://www.docker.com/products/docker-desktop/) vÃ  Docker Compose
* [Postman](https://www.postman.com/downloads/) (Ä‘á»ƒ test API)
* [Git](https://git-scm.com/downloads/)

---

## CÃ i Ä‘áº·t vÃ  Cháº¡y dá»± Ã¡n vá»›i Docker

ÄÃ¢y lÃ  cÃ¡ch Ä‘Æ¡n giáº£n vÃ  Ä‘Æ°á»£c khuyáº¿n khÃ­ch Ä‘á»ƒ cháº¡y toÃ n bá»™ há»‡ thá»‘ng chá»‰ vá»›i má»™t vÃ i lá»‡nh.

### BÆ°á»›c 1: Táº£i mÃ£ nguá»“n

```bash
Clone dá»± Ã¡n vá»
```

### BÆ°á»›c 2: Táº¡o cÃ¡c file cáº¥u hÃ¬nh Docker

Báº¡n cáº§n táº¡o cÃ¡c file sau trong dá»± Ã¡n cá»§a mÃ¬nh.

#### a. Táº¡o `Dockerfile` cho má»—i service

Táº¡o má»™t file tÃªn lÃ  `Dockerfile` trong **má»—i thÆ° má»¥c service** (`auth`, `product`, `order`, `api-gateway`) vá»›i ná»™i dung giá»‘ng há»‡t nhau:

```dockerfile
# Sá»­ dá»¥ng má»™t image Node.js chÃ­nh thá»©c lÃ m ná»n
FROM node:18-alpine

# Táº¡o thÆ° má»¥c lÃ m viá»‡c bÃªn trong container
WORKDIR /app

# Sao chÃ©p package.json vÃ  package-lock.json
COPY package*.json ./

# CÃ i Ä‘áº·t cÃ¡c dependencies
RUN npm install

# Sao chÃ©p toÃ n bá»™ mÃ£ nguá»“n cá»§a service vÃ o
COPY . .

# Má»Ÿ cá»•ng mÃ  á»©ng dá»¥ng sáº½ cháº¡y
EXPOSE 3000

# Lá»‡nh Ä‘á»ƒ khá»Ÿi cháº¡y á»©ng dá»¥ng
CMD ["npm", "start"]
```

#### b. Táº¡o file `docker-compose.yml`

á» thÆ° má»¥c **gá»‘c** cá»§a dá»± Ã¡n, táº¡o má»™t file tÃªn lÃ  `docker-compose.yml` vá»›i ná»™i dung sau:

```yaml
services:
  # Service MongoDB
  mongo:
    image: mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db

  # Service RabbitMQ
  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - "5672:5672"
      - "15672:15672"

  # Service Auth
  auth:
    build: ./auth
    ports:
      - "3001:3000"
    environment:
      - MONGODB_AUTH_URI=mongodb://mongo:27017/auth_db
      - JWT_SECRET=daylamotkhoabimatratmanhcuaban
    depends_on:
      - mongo

  # Service Product
  product:
    build: ./product
    ports:
      - "3002:3000"
    environment:
      - MONGODB_PRODUCT_URI=mongodb://mongo:27017/product_db
    depends_on:
      - mongo
      - rabbitmq

  # Service Order
  order:
    build: ./order
    ports:
      - "3003:3000"
    environment:
      - MONGODB_ORDER_URI=mongodb://mongo:27017/order_db
    depends_on:
      - mongo
      - rabbitmq

  # API Gateway
  api-gateway:
    build: ./api-gateway
    ports:
      - "3000:3000"
    depends_on:
      - auth
      - product
      - order

volumes:
  mongo-data:
```

### BÆ°á»›c 3: Khá»Ÿi cháº¡y há»‡ thá»‘ng

Má»Ÿ terminal á»Ÿ thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n vÃ  cháº¡y lá»‡nh:
```bash
docker-compose up --build
```
Lá»‡nh nÃ y sáº½ build image cho tá»«ng service vÃ  khá»Ÿi cháº¡y toÃ n bá»™ há»‡ thá»‘ng. Báº¡n sáº½ tháº¥y log cá»§a táº¥t cáº£ cÃ¡c service hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh.

Äá»ƒ dá»«ng há»‡ thá»‘ng, nháº¥n `Ctrl + C`.

---

## Kiá»ƒm tra (Testing) vá»›i Postman

Sau khi há»‡ thá»‘ng Ä‘Ã£ cháº¡y, báº¡n cÃ³ thá»ƒ dÃ¹ng Postman Ä‘á»ƒ kiá»ƒm tra cÃ¡c API. Má»i request Ä‘á»u Ä‘Æ°á»£c gá»­i Ä‘áº¿n API Gateway táº¡i `http://localhost:3000`.

### 1. ÄÄƒng kÃ½ tÃ i khoáº£n
* **Method**: `POST`
* **URL**: `http://localhost:3000/register`
* **Body** (`raw`, `JSON`):
    ```json
    {
        "username": "testuser1",
        "password": "password123"
    }
    Example:
    ```
![alt text](public/register.png)

### 2. ÄÄƒng nháº­p
* **Method**: `POST`
* **URL**: `http://localhost:3000/login`
* **Body** (`raw`, `JSON`):
    ```json
    {
        "username": "testuser1",
        "password": "password123"
    }
    Ecample:
    ```
    ![alt text](public/login.png)

* **Káº¿t quáº£**: Copy láº¡i giÃ¡ trá»‹ `token` tá»« response Ä‘á»ƒ sá»­ dá»¥ng cho cÃ¡c request tiáº¿p theo.

### 3. Táº¡o sáº£n pháº©m má»›i
* **Method**: `POST`
* **URL**: `http://localhost:3000/products/api/products`
* **Authorization**: Chá»n `Bearer Token` vÃ  dÃ¡n `token` Ä‘Ã£ copy á»Ÿ bÆ°á»›c 2.
* **Body** (`raw`, `JSON`):
    ```json
    {
        "name": "Laptop SiÃªu Má»ng 2025",
        "description": "ÄÃ¢y lÃ  mÃ´ táº£ chi tiáº¿t cho chiáº¿c laptop siÃªu má»ng Ä‘á»i má»›i.",
        "price": 25990000
    }
    ```
    ![alt text](public/createproduct.png)
   
* **Káº¿t quáº£**: Copy láº¡i giÃ¡ trá»‹ `_id` cá»§a sáº£n pháº©m vá»«a táº¡o.

### 4. Táº¡o Ä‘Æ¡n hÃ ng má»›i
* **Method**: `POST`
* **URL**: `http://localhost:3000/orders/create` (LÆ°u Ã½: Ä‘Æ°á»ng dáº«n nÃ y cÃ³ thá»ƒ khÃ¡c tÃ¹y theo code cá»§a báº¡n)
* **Authorization**: Tiáº¿p tá»¥c dÃ¹ng `Bearer Token`.
* **Body** (`raw`, `JSON`):
    ```json
    {
        "products": [
            {
                "productId": "DÃN_ID_Sáº¢N_PHáº¨M_Vá»ªA_Táº O_á»_TRÃŠN_VÃ€O_ÄÃ‚Y",
                "quantity": 1
            }
        ]
    }
    ```
 ![alt text](public/buy.png)

---

